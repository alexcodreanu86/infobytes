<div class="row">
	<h1><%= @tutorial.title %></h1>
	<p>Description: <%= @tutorial.description %></p>
  
  <div id="chapter-list">
		<% @tutorial.chapters.each do |chapter| %>
    	<div class="chapter" id="chapter-<%= chapter.id %>">
		    <h2><%= link_to chapter.title, chapter_path(chapter) %></h2>
		    <% if tutorial_creator? %>
	        <%= link_to '<i class="fa fa-minus-square fa-2x del-chapter"></i>'.html_safe, chapter_path(chapter), method: :delete, data: { confirm: "Are you sure?" } %> 
		    <% end %>
		  </div>
		<% end %>
  </div>

	<% if tutorial_creator? %>
    <%= link_to "Add Chapter <i class='fa fa-plus-square fa-2x'></i>".html_safe, new_tutorial_chapter_path(@tutorial), id: "add-chapter" %>
    <div id="chapter-form" style="display: none;"></div>
	<% end %>
 
</div>


<% if tutorial_creator? %>
  <script>
    $('#add-chapter').on("click", function(e){
    	e.preventDefault();
      var url = $(this).attr("href");
      
    	$.get(url, function(serverResponse, status, request){
        $("#chapter-form").html(serverResponse).slideDown(200);
    	});
    });

  	$('#chapter-form').on("submit", "#new_chapter", function(e){
      e.preventDefault();
      
      var data = $(this).serialize();
      var url = $(this).attr("action");

      if ($('#chapter_title').val() === "") {
        $("#chapter_title").css("border-color", "red")
      } else {
        $.post(url, data, function(serverResponse, status, request){
          var chapter = serverResponse; 
          $("#chapter-list").append("<div class='chapter' id='chapter-" + chapter.id + "'><h2>" + chapter.title + "</h2><a data-confirm='Are you sure?' data-method='delete' href='/chapters/" + chapter.id + "' rel='nofollow'><i class='fa fa-minus-square fa-2x del-chapter'></i></a> </div>");
          $("#chapter-form").slideUp();
        }, "json");
      };
  	});
  </script>
<% end %>



<%#= render "tutorials/display_tutorial" %>


